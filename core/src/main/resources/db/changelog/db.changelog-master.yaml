databaseChangeLog:
  - logicalFilePath: db/changelog/db.changelog-master.yaml
  - changeSet:
      id: 1
      author: shushkevich
      comment: "Create users table"
      changes:
        createTable:
          tableName: users
          columns:
            - column:
                name: id
                type: int
                autoIncrement: true
                constraints:
                  primaryKey: true
                  nullable: false
            - column:
                name: name
                type: varchar(20)
            - column:
                name: surname
                type: varchar(20)
                constraints:
                  nullable: false
            - column:
                name: patronymic
                type: varchar(20)
            - column:
                name: client_id
                type: int
            - column:
                name: born_date
                type: date
            - column:
                name: email
                type: varchar(50)
                constraints:
                  unique: true
                  nullable: false
            - column:
                name: town
                type: varchar(20)
            - column:
                name: street
                type: varchar(20)
            - column:
                name: house
                type: varchar(5)
            - column:
                name: flat
                type: varchar(5)
            - column:
                name: login
                type: varchar(15)
                constraints:
                  unique: true
                  nullable: false
            - column:
                name: password
                type: varchar(72)
                constraints:
                  nullable: false
            - column:
                name: passport_number
                type: varchar(30)
            - column:
                name: passport_issued_by
                type: varchar(50)

  - changeSet:
      id: 2
      author: shushkevich
      comment: "Create user_roles table and make SYS_ADMIN role unique"
      changes:
        createTable:
          tableName: user_roles_table
          columns:
            - column:
                name: users_id
                type: int4
                constraints:
                  nullable: false
                  foreignKeyName: user
                  references: users(id)
            - column:
                name: user_roles
                type: varchar(30)
  - changeSet:
      id: 3
      author: shushkevich
      comment: "make SYS_ADMIN unique"
      changes:
        - sql:
            endDetemiter: \nGO
            sql: CREATE UNIQUE INDEX idx_userroles ON public.user_roles_table(user_roles) WHERE user_roles = 'SYS_ADMIN';
  - changeSet:
      id: 4
      author: some
      comment: "create SYS_ADMIN user"
      changes:
        - insert:
            tableName: users
            columns:
              - column:
                  name: name
                  value: "admin"
              - column:
                  name: surname
                  value: "admin"
              - column:
                  name: email
                  value: "admin@server.com"
              - column:
                  name: login
                  value: "admin"
              - column:
                  name: password
                  value: "admin"
        - insert:
            tableName: user_roles_table
            columns:
              - column:
                  name: users_id
                  value: 1
              - column:
                  name: user_roles
                  value: "SYS_ADMIN"